@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    string[] listFile = ViewBag.filePaths;
    int id = ViewBag.id;
    string TenHoiDongThi = ViewBag.TenHoiDongThi ;
    string IDHoiDongThi = ViewBag.IDHoiDongThi + "";
    string ID_Exam = ViewBag.ID_Exam + "";
    string TenExam = ViewBag.TenExam;
    string TenPhong = ViewBag.TenPhong ;
    string IdPhong = ViewBag.IdPhong + "";
    List<string> header = (List<string>)ViewBag.header;
    List<string> example = (List<string>)ViewBag.example;

    


    //var lst_MT = (List<Quản_lý_điểm_thi.Models.MT_VALUE_NAME>)ViewBag.lst_MT;
}
@section Styles
{
    <link href="~/dist/css/component.css" rel="stylesheet" />
    <link href="~/Content/select2.css" rel="stylesheet" />
    <style>
        .dataTables_info{
            font-size:10px;
        }
            a{
        font-size:15px;
    }
            .visibilityHide
{
  visibility:hidden;
}
            .inputfile {
	width: 0.1px;
	height: 0.1px;
	opacity: 0;
	overflow: hidden;
	position: absolute;
	z-index: -1;
}
            .modal {
text-align: center;
}

.modal:before {
display: inline-block;
vertical-align: middle;
content: " ";
height: 100%;
}

.modal-dialog {
display: inline-block;
text-align: left;
vertical-align: middle;
    width: 300px;
}
    </style>

}
@section script
{
    <script src="~/dist/js/custom-file-input.js"></script>
    <script src="~/dist/js/jquery.dataTables.js"></script>
    <script src="~/dist/js/dataTables.bootstrap4.js"></script>
    <!-- #region RELOAD -->
    <script>
        function reload()
        {
            location.reload();
            document.getElementById('search').value = "";
        }
    </script>
    <!-- #endregion -->
    <!-- #region Tạo bảng dữ liệu -->
    <script>
        var id_Exam_Room = @id;
        var arr = [0, 1, 2, 3,  5, 6, 7, 8, 9, 10,11];
        var arr1 = [11];
        $(document).ready(function () {
           var t = $("#demoGrid").DataTable({
                initComplete: function() {
                    $(this.api().table().container()).find('input').parent().wrap('<form>').parent().attr('autocomplete', 'off');
                },
                "processing": true, // for show progress bar
                "serverSide": true, // for process server side
                "filter": true, // this is for disable filter (search box)
                "orderMulti": false, // for disable multiple column at once
                "pageLength": 50,
                "searching": false,
                "ajax": {
                    "url": "/Student/LoadData/" + id_Exam_Room,
                    "type": "POST",
                    "datatype": "json"
                },
                "columnDefs":
 [         { "width": "50px", "targets": 1 },
              { "width": "50px", "targets": 0 },
    { "width": "200px", "targets": 6 },

 {
     "targets": [6],
     "searchable": false,
     "orderable": false,
     "className" : 'text-center'
    }
 ],

                "columns": [
                      { "data": "Id", "name": "Id", "autoWidth": true },
                                             {
                                                 "render": function (data, type, full, meta) {
                                                     return '<a href="/Student/detail/' + full.Id + '"><img src="/dist/img/icons8-pdf-48.png"  alt="pdf-diem-thi" style="width:30px;height:30px;margin-left:20px;cursor:pointer"></a>' ;
                                                 }
                                             },

                                                                 {
                                                                     "render": function (data, type, full, meta) {
                                                                         return '<a href="/Student/detail/' + full.Id + '">'+full.ho_ten+'</a>' ;
                                                                     }
                                                                 },
                      { "data": "sbd", "name": "sbd", "autoWidth": true },
                 
                      { "data": "ngay_sinh", "name": "ngay_sinh", "autoWidth": true },
                      { "data": "ketqua_thi", "name": "ketqua_thi", "autoWidth": true },
                      {
                          "render": function (data, type, full, meta)

                          {
                              return  '<button type="button"  onclick = "DeleteData(' + full.Id + ')" style="padding:2px 6px;margin-left: 10px;border-radius: 10px !important;" class="btn btn-danger"><i class="fa fa-trash"></i></button>' 
                          }
                      },
                ]
           });
           t.on('draw.dt', function () {
               var PageInfo = $('#demoGrid').DataTable().page.info();
               t.column(0, { page: 'current' }).nodes().each(function (cell, i) {
                   cell.innerHTML = i + 1 + PageInfo.start;
               });
           });

           $('#btnUpload').click(function () {

               // Checking whether FormData is available in browser
               if (window.FormData !== undefined) {

                   var fileUpload = $("#FileUpload1").get(0);
                   var files = fileUpload.files;
                   var id = @id;
                   // Create FormData object
                   var fileData = new FormData();

                   // Looping over all files and add it to FormData object
                   for (var i = 0; i < files.length; i++) {
                       fileData.append(files[i].name, files[i]);
                   }

                   // Adding one more key to FormData object
                   fileData.append('username', 'Manas');

                   $.ajax({
                       url: '/Student/UploadFiles/'+id,
                       type: "POST",
                       contentType: false, // Not to set any content header
                       processData: false, // Not to process data
                       data: fileData,
                       success: function (result) {
                           location.reload();
                           alert(result);
                       },
                       error: function (err) {
                           alert(err.statusText);
                       }
                   });
               } else {
                   alert("FormData is not supported.");
               }
           });
            $('#btnUploadExcel').click(function () {

                // Checking whether FormData is available in browser
                if (window.FormData !== undefined) {

                    var fileUpload = $("#FileExcel1").get(0);
                    var files = fileUpload.files;
                    var id = @id;
                    // Create FormData object
                    var fileData = new FormData();

                    // Looping over all files and add it to FormData object
                    for (var i = 0; i < files.length; i++) {
                        fileData.append(files[i].name, files[i]);
                    }

                    // Adding one more key to FormData object
                    fileData.append('username', 'Manas');

                    $.ajax({
                        url: '/Student/UploadExcel/'+id,
                        type: "POST",
                        contentType: false, // Not to set any content header
                        processData: false, // Not to process data
                        data: fileData,
                        success: function (result) {
                            //location.reload();
                            alert(result);
                        },
                        error: function (err) {
                            alert(err.statusText);
                        }
                    });
                } else {
                    alert("FormData is not supported.");
                }
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            var tab_text;
            var data_type = 'data:application/vnd.ms-excel';
            @*var header = @header;
            var example = @example;*@
            $("input[type='search']").wrap("<form>");
            $("input[type='search']").closest("form").attr("autocomplete", "off");
        });
    </script>
    <!-- #endregion -->
<!-- #region Xóa phòng thi -->
<script>
    function DeleteData(id) {
       
        $("#deleteId").val(id)
        $('#modalAlertDelete').modal('show')
   }
    $('#modalAlertDelete').on('hide.bs.modal', function (event) {
        $("#deleteId").val('')
        hideMessage();
    })

    $('#btnDeleteAccess').on('click', function () {
        hideMessage();
        $.ajax({
            url: '/Student/deleteJS',
            type: "POST",
            data: $("#formDelete").serialize(),
            success: function (result) {
                if (data != -1)  {
                  showSuccessMessage('Xóa thông tin học sinh hoàn tất.')
                } else {
                    showAlterMessage(result.Message)
                }
            },
            error: function (err) {
                alert(err.statusText);
            }
        });
        $('#modalAlertDelete').modal('hide')
        reload();
    })
</script>

<!-- #endregion -->
        <script>
        function fnExcelReport() {
            //CreateHiddenTable();

            tab_text = '<html xmlns:x="urn:schemas-microsoft-com:office:excel">';
            tab_text = tab_text + '<head><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>';

            tab_text = tab_text + '<x:Name>Error Messages</x:Name>';

            tab_text = tab_text + '<x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet>';
            tab_text = tab_text + '</x:ExcelWorksheets></x:ExcelWorkbook></xml></head><body>';

            tab_text = tab_text + "<table border='1px'>";
            tab_text = tab_text + $('#myModifiedTable').html();;
            tab_text = tab_text + '</table></body></html>';

            data_type = 'data:application/vnd.ms-excel';

            var ua = window.navigator.userAgent;
            var msie = ua.indexOf("MSIE ");

            if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./)) {
                if (window.navigator.msSaveBlob) {
                    var blob = new Blob([tab_text], {
                        type: "application/csv;charset=utf-8;"
                    });
                    navigator.msSaveBlob(blob, 'Test file.xls');
                }
            } else {
                console.log(data_type);
                console.log(tab_text);
                $('#testAnchor')[0].click()
            }
            $('#MessageHolder').html("");
        }
        $($("#testAnchor")[0]).click(function(){
            console.log(data_type);
            console.log(tab_text);
            $('#testAnchor').attr('href', data_type + ', ' + encodeURIComponent(tab_text));
            $('#testAnchor').attr('download', 'file_mau.xls');
        });
    </script>
}

@section path{
<li><a href="/Home/Index"><i class="fa fa-home"></i> Trang chủ</a></li>
<li><a href="/exam/Index">Danh sách khoá thi</a></li>
<li><a href="/HoiDongThi/Index/@ID_Exam">@TenExam</a></li>
<li><a href="/ExamRoom/Index/@IDHoiDongThi">@TenHoiDongThi</a></li>
<li><a href="/Student/Index/@IdPhong">@TenPhong</a></li>
    <li class="active" id=""></li>
}
<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <div class="nav-tabs-custom" style="border-top:1px solid #f9fafc">
                <ul class="nav nav-tabs">
                    <li class="active"><a style="font-weight:bold" data-toggle="tab" href="#tab_1" aria-expanded="true" id="zoneTong1">Danh sách học sinh</a></li>
                </ul>
            </div>
            <div class="box-body" style="padding:0px !important; margin-bottom:5px;text-align:right">
                <div class="col-sm-7">
                    <dIV class="form-group col-sm-6">
                        <div class="form-group col-sm-5">
                            <label class="pull-left" for="exampleInputFile">Chọn pdf của thí sinh</label>
                            <input type="file" id="FileUpload1" name="uploadFile">

                        </div>
                        <div class="form-group col-sm-3">
                            <label for="exampleInputFile" style="width:100%">&nbsp;&nbsp;</label>
                            <button id="btnUpload">UPLOAD</button>
                        </div>
                    </dIV>

                    <div class="form-group col-sm-3">
                        <label>Danh sách file pdf</label>
                        <select class="form-control" id="select-file" onchange="myFunction();">
                
                            @for (int i = 0; i < listFile.Length; i++)
                            {
                                    <option>@listFile[i]</option>                               
                            }
                        </select>
                    </div>
                    <div class="form-group col-sm-3">

                    </div>
                    <div class="form-group col-sm-3">

                    </div>
                </div>
                <a href="/Student/Createnew/@id"><button type="button" class="btn btn-primary" style="border-radius:10px;"><i class="fa fa-plus"></i> Thêm thí sinh</button></a>

                <a class="btn btn-default" onclick="reload();" id="btnrefresh" title="Tải lại dữ liệu mới"><i class="fa fa-refresh"></i> Tải lại</a>
                <a class="btn btn-default" id="test" onClick="fnExcelReport();" title=""><i class="fa fa-file-excel-o"></i> Tải excel mẫu</a>
                <button type="button" class="btn btn-primary" style="border-radius:10px;" data-toggle="modal" data-target="#createModal"> 
                    <i class="fa fa-file-excel-o"></i>Import dữ liệu từ Excel
                </button>

            </div>

            <div class="tab-content">
                <div id="tab_1" class="tab-pane active">
                    <div class="box">


                        <div class="box-body" style="padding:0px !important; margin-bottom:10px">
                            <div id="tbldata_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                                <div class="row"><div class="col-sm-6"></div><div class="col-sm-6"></div></div><div class="row">
                                    <div class="col-sm-12">

                                        <table id="demoGrid" class="table table-bordered table-hover dataTable" role="grid">
                                            <thead>
                                                <tr role="row">
                                                    <th></th>
                                                    <th>PDF</th>
                                                    <th>Họ tên</th>
                                                    <th>Số báo danh</th>
                                                    <th>Ngày sinh</th>
                                                    <th>Kết quả thi</th>
                                             
                                                    <th></th>
                                              

                                                </tr>
                                            </thead>

                                        </table><div id="tbldata_processing" class="dataTables_processing" style="display: none;">Đang tải dữ liệu...</div>
                                    </div>
                                </div><div class="row"><div class="col-sm-5"></div><div class="col-sm-7"></div></div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Model thêm mới ki` thi-->
<div class="modal fade in" id="createModal" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="padding:10PX">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    
                        <div class="row" style="text-align:center">
                            @*<label class="pull-left" for="exampleInputFile">Chọn file excel</label>*@
                            <input type="file" id="FileExcel1" name="uploadExcel" class="inputfile inputfile-4">

                            @*<input type="file" name="file-5[]" id="file-5" class="inputfile inputfile-4" />*@
                            <label for="FileExcel1">
                                <figure>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17">
                                        <path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z" />
                                    </svg>
                                </figure>
                                <span style="font-weight:bold">Chọn file Excel</span>
                            </label>
                        </div>
                        <div class="row"style="text-align:center">
                   
                            <button type="button" class="btn btn-primary"  id="btnUploadExcel" style="width:120px">UPLOAD</button>
                            <span></span>
                         
                        </div>
              
                </div>

            </div>

        </div>
    </div>
</div>
<div id='MessageHolder'>
    <table id="myModifiedTable" class="visibilityHide">
        <thead>
            <tr>
                @for (var i = 0; i < @header.Count; i++)
                {
                    <th>@header[i]</th>
                }
            </tr>
        </thead>
        <tbody>
            <tr>
                @for (var i = 0; i < @example.Count; i++)
                {
                    <td>@example[i]</td>
                }
            </tr>
        </tbody>
    </table>
</div>
<a href="#" id="testAnchor"></a>

@Html.Action("MessageBox", "Common")