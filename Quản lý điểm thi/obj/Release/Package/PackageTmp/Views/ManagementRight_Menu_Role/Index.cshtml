@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var listMenu = (List<Quản_lý_điểm_thi.Models.MnuItem>)ViewBag.ListMenu;
    var listParent = (List<Quản_lý_điểm_thi.Models.MnuItem>
    )ViewBag.ListParent;

    var rCurID = (int?)ViewBag.RoleCurID;

    Quản_lý_điểm_thi.Models.MnuItem item, item1, item2;

    var i = 0;
}

<h2>Phân quyền hệ thống</h2>

<div class="row">
    <div class="col-md-12">
        <h3>Lựa chọn vai trò:</h3>
    </div>
</div>

@using (Html.BeginForm())
{
    <div class="row">
        <div class="col-md-12">
            <table>
                <tr>
                    <td width="100px" align="right">
                        <select name="roleID">
                            <!--onchange="gotoURL()-->
                            @if (rCurID == 1)
                            {
                                <option value="1" selected>Admin</option>
                            }
                            else
                            {
                                <option value="1">Admin</option>
                            }

                            @if (rCurID == 2)
                            {
                                <option value="2" selected>Cấp 1</option>
                            }
                            else
                            {
                                <option value="2">Cấp 1</option>
                            }

                            @if (rCurID == 3)
                            {
                                <option value="3" selected>Cấp 2</option>
                            }
                            else
                            {
                                <option value="3">Cấp 2</option>
                            }

                            @if (rCurID == 5)
                            {
                                <option value="5" selected>Cấp 3</option>
                            }
                            else
                            {
                                <option value="5">Cấp 3</option>
                            }
                        </select>
                    </td>
                    <td>
                        <button type="submit" value="select">Chọn</button>
                    </td>
                </tr>
            </table>
        </div>
    </div>
}
<p></p>

@using (Html.BeginForm())
{
    <div class="card mb-3">
        <div class="card-header">
            <i class="fa fa-table"></i> Lựa chọn các chức năng:
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <!---Lay thong roleID hien tai-->
                @*<input type="hidden" name="roleID" value="@rCurID" />*@

                <table class="table" id="dataTable" width="100" cellspacing="0">
                    <tr>
                        <td colspan="2" style="color:red; text-align:center">
                            @if (ViewBag.KQ != "")
                            {
                                <b>@ViewBag.KQ</b>
                            }
                        </td>
                        <td style="text-align:right"><button type="submit" value="save">Lưu</button></td>
                    </tr>

                    @for (i = 0; i <= listParent.Count - 3; i += 3)
                    {
                        item = listParent[i];
                        item1 = listParent[i + 1];
                        item2 = listParent[i + 2];

                        <tr>
                            <td>
                                <table width="90%" border="1" align="center">
                                    <tr>
                                        <th>
                                            @item.MenuName
                                        </th>
                                        <td align="right">
                                            <input name="lstItemOfRole" type="checkbox" value="@item.Id" checked="@item.Checked" />
                                            <input type="hidden" name="roleID" value="@ViewBag.RoleID" />
                                        </td>
                                    </tr>
                                    @foreach (var subItem in listMenu)
                                    {
                                        if (subItem.ParentId == item.Id)
                                        {
                                            <tr>
                                                <td>
                                                    @subItem.MenuName
                                                </td>
                                                <td align="right">
                                                    <input name="lstItemOfRole" type="checkbox" value="@subItem.Id" checked="@subItem.Checked" />
                                                </td>
                                            </tr>
                                        }
                                    }
                                </table>
                            </td>


                            <td>
                                <table width="90%" border="1" align="center">
                                    <tr>
                                        <th>
                                            @item1.MenuName
                                        </th>
                                        <td align="right">
                                            <input name="lstItemOfRole" type="checkbox" value="@item1.Id" checked="@item1.Checked" />
                                        </td>
                                    </tr>
                                    @foreach (var subItem in listMenu)
                                    {
                                        if (subItem.ParentId == item1.Id)
                                        {
                                            <tr>
                                                <td>
                                                    @subItem.MenuName
                                                </td>
                                                <td align="right">
                                                    <input name="lstItemOfRole" type="checkbox" value="@subItem.Id" checked="@subItem.Checked" />
                                                </td>
                                            </tr>
                                        }
                                    }
                                </table>
                            </td>

                            <td>
                                <table width="90%" border="1" align="center">
                                    <tr>
                                        <th>
                                            @item2.MenuName
                                        </th>
                                        <td align="right">
                                            <input name="lstItemOfRole" type="checkbox" value="@item2.Id" checked="@item2.Checked" />
                                        </td>
                                    </tr>
                                    @foreach (var subItem in listMenu)
                                    {
                                        if (subItem.ParentId == item2.Id)
                                        {
                                            <tr>
                                                <td>
                                                    @subItem.MenuName
                                                </td>
                                                <td align="right">
                                                    <input name="lstItemOfRole" type="checkbox" value="@subItem.Id" checked="@subItem.Checked" />
                                                </td>
                                            </tr>
                                        }
                                    }
                                </table>
                            </td>
                        </tr>
                    }
                </table>
            </div>
        </div>
    </div>
}

<script>
        var fileReport = null;
        $(document).ready(gotoURL());
        function gotoURL() {
            var typeId = $("#reportTypeDropdown").val();
            $.ajax
                ({
                    url: '/ManagementRight_Menu_Role/Index',
                    type: 'POST',
                    datatype: 'application/json',
                    contentType: 'application/json',
                    //data: JSON.stringify({
                    //    typeId: +typeId
                    //}),
                    success: success,
                });
        }
</script>